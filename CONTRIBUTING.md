# Guidance on how to contribute

> All contributions to this project will be released under the CC0 public domain
> dedication. By submitting a pull request or filing a bug, issue, or
> feature request, you are agreeing to comply with this waiver of copyright interest.
> Details can be found in our [TERMS](TERMS.md) and [LICENCE](LICENSE).


There are two primary ways to help:
 - Using the issue tracker, and
 - Changing the code-base.


## Using the issue tracker

Use the issue tracker to suggest feature requests, report bugs, and ask questions.
This is also a great way to connect with the developers of the project as well
as others who are interested in this solution.

Use the issue tracker to find ways to contribute. Find a bug or a feature, mention in
the issue that you will take on that effort, then follow the _Changing the code-base_
guidance below.


## Changing the code-base

Generally speaking, you should fork this repository, make changes in your
own fork, and then submit a pull-request. All new code should have associated unit
tests that validate implemented features and the presence or lack of defects.
Additionally, the code should follow any stylistic and architectural guidelines
prescribed by the project. In the absence of such guidelines, mimic the styles
and patterns in the existing code-base.

## Release management

Ready to publish changes to npm?

### Config prep:
1. If you don't have a `.env` file,
   copy it from the sample file with `cp .env_SAMPLE .env`.
2. Add a `GITHUB_TOKEN` in your `.env` file (see
   https://github.com/settings/tokens/new?scopes=repo&description=ccdb-release-it
   to create the token value).
   Set the desired token expiry length and click generate.
3. You need to be part of the collaborators for
   https://www.npmjs.com/package/@cfpb/ccdb5-ui.
   Ask a member of the [consumerfinance.gov](https://github.com/cfpb/consumerfinance.gov) team if you are not.


### Steps:
1. Ensure you're on `main` and `git pull` to confirm you're up-to-date.
2. Run `yarn run build` to ensure you have the latest built artifacts for npm.
   Commit any changes to `/dist/` directory files to `main`.
3. Source your `.env` with `source ./.env` (if `GITHUB_TOKEN` in unset).
4. Log into npm with `npm login` (if not already logged in).
5. Run `yarn run release` to start the release.
   This'll run the build scripts to copy the latest JS into
   the `dist` directory. It then uses
   [release-it](https://github.com/release-it/release-it/) to publish to
   npm and create a GitHub tag.
6. Manually create an entry in the GitHub releases changelog by visiting
   https://github.com/cfpb/ccdb5-ui/releases and clicking "Draft a new release":
   - Choose the latest tag generated by the release script in the prior step.
   - Title the release the same as the release version.
   - Click "Auto-generate release notes" or manually enter release notes.
   - Click "Publish release"


### Post-publish steps in consumerfinance.gov
1. Navigate to the root directory of the
  [consumerfinance.gov](https://github.com/cfpb/consumerfinance.gov) repo.
2. Create a new branch.
3. Move to CCDB asset app directory with `cd cfgov/unprocessed/apps/ccdb-search/`.
4. `npx yarn-check -u` and update to the latest ccdb5-ui version.
5. Commit the changes to the npm package and node cache.
6. Open a Pull Request from the branch for review.


### Troubleshooting
 - `yarn run release` can't find https://www.npmjs.com/package/@cfpb/ccdb5-ui
   and doesn't succeed.
   - You're probably not an npm maintainer on the ccdb5-ui project.
     Reach out to a core consumerfinance.gov member to get access.
 - When updating the package in the consumerfinance.gov repo you get a message
   similar to "Cannot download package in offline mode."
   - This is likely an outdated cache issue, perform the following:
     - Delete `cfgov/unprocessed/apps/ccdb-search/npm-packages-offline-cache`
     - Delete `cfgov/unprocessed/apps/ccdb-search/node_modules`
     - Delete `cfgov/unprocessed/apps/ccdb-search/yarn.lock`
     - Temporarily edit the root directory `.yarnrc` file
       and remove the last two lines and save.
     - Run `yarn cache clean; yarn install`
       from `cfgov/unprocessed/apps/ccdb-search/`.
     - Re-add the last two lines to the root `.yarnrc` file.
